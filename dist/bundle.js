(()=>{"use strict";class n{constructor(){this.bills=[]}createBill(n){const e=this.generateId(),t={id:e,name:n,persons:[],items:[]};return this.bills.push(t),e}getBills(){return this.bills}getBill(n){return this.bills.find((e=>e.id===n))}deleteBill(n){const e=this.bills.findIndex((e=>e.id===n));return-1!==e&&(this.bills.splice(e,1),!0)}addPerson(n,e){const t=this.getBill(n);if(!t)return!1;const o={id:this.generateId(),name:e};return t.persons.push(o),!0}addItem(n,e,t){const o=this.getBill(n);if(!o)return!1;const r={id:this.generateId(),name:e,price:t,dividers:[]};return o.items.push(r),!0}togglePersonAsDivider(n,e,t){const o=this.getBill(n);if(!o)return!1;const r=o.items.find((n=>n.id===e));if(!r)return!1;if(!o.persons.find((n=>n.id===t)))return!1;const a=r.dividers.indexOf(t);return-1===a?r.dividers.push(t):r.dividers.splice(a,1),!0}calculateBillSummary(n){const e=this.getBill(n);if(!e)return[];const t=[];return e.persons.forEach((n=>{const o={personId:n.id,personName:n.name,totalAmount:0,itemBreakdown:[]};e.items.forEach((e=>{if(e.dividers.includes(n.id)){const n=e.price/e.dividers.length;o.totalAmount+=n,o.itemBreakdown.push({itemName:e.name,itemPrice:e.price,splitAmount:n,splitWith:e.dividers.length})}})),t.push(o)})),t}removePerson(n,e){const t=this.getBill(n);if(!t)return!1;const o=t.persons.findIndex((n=>n.id===e));return-1!==o&&(t.items.forEach((n=>{const t=n.dividers.indexOf(e);-1!==t&&n.dividers.splice(t,1)})),t.persons.splice(o,1),!0)}removeItem(n,e){const t=this.getBill(n);if(!t)return!1;const o=t.items.findIndex((n=>n.id===e));return-1!==o&&(t.items.splice(o,1),!0)}generateId(){return Math.random().toString(36).substr(2,9)}}class e{constructor(){this.currentBillId=null,this.calculator=new n,this.isDarkTheme="dark"===localStorage.getItem("billCalculatorTheme")||null===localStorage.getItem("billCalculatorTheme")&&window.matchMedia("(prefers-color-scheme: dark)").matches,this.initializeUI(),this.applyTheme()}initializeUI(){document.body.innerHTML='\n      <div class="container">\n        <div class="app-header">\n          <h1>Bill Calculator</h1>\n          <button id="themeToggle" class="theme-toggle" onclick="billUI.toggleTheme()">\n            <span class="theme-icon">🌙</span>\n            <span class="theme-text">Dark</span>\n          </button>\n        </div>\n        \n        \x3c!-- Bill Management --\x3e\n        <div class="section">\n          <h2>Bills</h2>\n          <div class="form-group">\n            <input type="text" id="billName" placeholder="Enter bill name">\n            <button onclick="billUI.createNewBill()">Create Bill</button>\n          </div>\n          <div id="billsList"></div>\n        </div>\n\n        \x3c!-- Current Bill Management --\x3e\n        <div id="currentBillSection" style="display: none;">\n          <div class="section">\n            <div class="bill-header">\n              <h2 id="currentBillTitle">Current Bill</h2>\n              <button class="delete-bill-btn" onclick="billUI.deleteCurrentBill()">Delete Bill</button>\n            </div>\n\n            \x3c!-- Interactive Summary Table --\x3e\n            <div class="subsection">\n              <div class="summary-header">\n                <h3>Payment Summary & Management</h3>\n                <div class="action-buttons">\n                  <button id="addPersonBtn" class="add-person-btn-external" onclick="billUI.showPersonModal()" style="display: none;">\n                    + Add Person\n                  </button>\n                  <button id="addItemBtn" class="add-item-btn-external" onclick="billUI.showItemModal()" style="display: none;">\n                    + Add Item\n                  </button>\n                  <button id="exportBtn" class="export-btn-external" onclick="billUI.exportTableToImage()" style="display: none;">\n                    📷 Export\n                  </button>\n                </div>\n              </div>\n              <p class="instructions-text">\n                <strong>Instructions:</strong> Use "Add Person" and "Add Item" buttons to manage your bill. Check boxes to include a person in splitting an item\'s cost. \n                Use "Delete" buttons to remove people or items.\n              </p>\n              <div id="summaryTable"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n        \x3c!-- Person Input Modal --\x3e\n        <div id="personInputModal" class="modal-overlay" style="display: none;" aria-hidden="true">\n          <div class="modal-content" data-modal="person">\n            <div class="modal-header">\n              <h3 class="modal-title">Add Person</h3>\n              <button class="modal-close" onclick="billUI.closePersonModal()" aria-label="Close modal">×</button>\n            </div>\n            <div class="modal-body">\n              <div class="modal-form-group">\n                <label class="modal-label" for="modalPersonName">Person Name</label>\n                <input \n                  type="text" \n                  id="modalPersonName" \n                  class="modal-input" \n                  placeholder="Enter person\'s name"\n                  maxlength="50"\n                  autocomplete="name"\n                />\n                <div class="modal-form-hint">Who will be splitting the bill?</div>\n                <div class="modal-error-message" id="personNameError"></div>\n              </div>\n            </div>\n            <div class="modal-footer">\n              <button class="modal-btn modal-btn-secondary" onclick="billUI.closePersonModal()">\n                Cancel\n              </button>\n              <button class="modal-btn modal-btn-primary" onclick="billUI.addPersonFromModal()" id="addPersonBtn">\n                <span>Add Person</span>\n              </button>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Item Input Modal --\x3e\n        <div id="itemInputModal" class="modal-overlay" style="display: none;" aria-hidden="true">\n          <div class="modal-content" data-modal="item">\n            <div class="modal-header">\n              <h3 class="modal-title">Add Item</h3>\n              <button class="modal-close" onclick="billUI.closeItemModal()" aria-label="Close modal">×</button>\n            </div>\n            <div class="modal-body">\n              <div class="modal-form-group">\n                <label class="modal-label" for="modalItemName">Item Name</label>\n                <input \n                  type="text" \n                  id="modalItemName" \n                  class="modal-input" \n                  placeholder="e.g., Pizza, Drinks, Appetizer"\n                  maxlength="100"\n                />\n                <div class="modal-form-hint">What item are you adding to the bill?</div>\n                <div class="modal-error-message" id="itemNameError"></div>\n              </div>\n              <div class="modal-form-group">\n                <label class="modal-label" for="modalItemPrice">Price ($)</label>\n                <input \n                  type="number" \n                  id="modalItemPrice" \n                  class="modal-input" \n                  placeholder="0.00"\n                  step="0.01"\n                  min="0"\n                  max="9999.99"\n                />\n                <div class="modal-form-hint">Enter the total cost of this item</div>\n                <div class="modal-error-message" id="itemPriceError"></div>\n              </div>\n            </div>\n            <div class="modal-footer">\n              <button class="modal-btn modal-btn-secondary" onclick="billUI.closeItemModal()">\n                Cancel\n              </button>\n              <button class="modal-btn modal-btn-primary" onclick="billUI.addItemFromModal()" id="addItemBtn">\n                <span>Add Item</span>\n              </button>\n            </div>\n          </div>\n        </div>\n\n\n      <style>\n        :root {\n          /* Light theme colors */\n          --bg-primary: #ffffff;\n          --bg-secondary: #f8f9fa;\n          --bg-tertiary: #e9ecef;\n          --text-primary: #212529;\n          --text-secondary: #6c757d;\n          --text-tertiary: #495057;\n          --border-color: #dee2e6;\n          --border-light: #e9ecef;\n          --shadow: rgba(0, 0, 0, 0.1);\n          \n          /* Table colors - Light theme with better contrast */\n          --table-bg: #ffffff;\n          --table-header-bg: #343a40;\n          --table-header-text: #ffffff;\n          --table-row-odd: #f8f9fa;\n          --table-row-even: #e9ecef;\n          --table-row-hover: #dee2e6;\n          --table-border: #495057;\n          --table-person-bg: #6c757d;\n          --table-person-text: #ffffff;\n          --table-total-bg: #28a745;\n          --table-total-text: #ffffff;\n          \n          /* Button colors */\n          --btn-primary: #007bff;\n          --btn-primary-hover: #0056b3;\n          --btn-success: #28a745;\n          --btn-success-hover: #218838;\n          --btn-danger: #dc3545;\n          --btn-danger-hover: #c82333;\n          --btn-secondary: #6c757d;\n          --btn-secondary-hover: #5a6268;\n        }\n\n        [data-theme="dark"] {\n          /* Dark theme colors */\n          --bg-primary: #1a1a1a;\n          --bg-secondary: #2d2d2d;\n          --bg-tertiary: #404040;\n          --text-primary: #ffffff;\n          --text-secondary: #cccccc;\n          --text-tertiary: #aaaaaa;\n          --border-color: #404040;\n          --border-light: #555555;\n          --shadow: rgba(0, 0, 0, 0.3);\n          \n          /* Table colors - Dark theme */\n          --table-bg: #1f2937;\n          --table-header-bg: #111827;\n          --table-header-text: #f3f4f6;\n          --table-row-odd: #374151;\n          --table-row-even: #4b5563;\n          --table-row-hover: #6b7280;\n          --table-border: #374151;\n          --table-person-bg: #374151;\n          --table-person-text: #f9fafb;\n          --table-total-bg: #059669;\n          --table-total-text: #f0fff4;\n          \n          /* Button colors - keep same for consistency */\n          --btn-primary: #007bff;\n          --btn-primary-hover: #0056b3;\n          --btn-success: #28a745;\n          --btn-success-hover: #218838;\n          --btn-danger: #ef4444;\n          --btn-danger-hover: #dc2626;\n          --btn-secondary: #6c757d;\n          --btn-secondary-hover: #5a6268;\n        }\n\n        body {\n          background-color: var(--bg-primary);\n          color: var(--text-primary);\n          transition: background-color 0.3s ease, color 0.3s ease;\n          margin: 0;\n          font-family: Arial, sans-serif;\n        }\n\n        .container { \n          max-width: 1200px; \n          margin: 0 auto; \n          padding: 20px; \n        }\n\n        .app-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: 30px;\n          padding-bottom: 20px;\n          border-bottom: 2px solid var(--border-color);\n        }\n\n        .app-header h1 {\n          margin: 0;\n          color: var(--text-primary);\n        }\n\n        .theme-toggle {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          padding: 10px 16px;\n          background-color: var(--bg-tertiary);\n          color: var(--text-primary);\n          border: 2px solid var(--border-color);\n          border-radius: 25px;\n          cursor: pointer;\n          font-size: 14px;\n          font-weight: 500;\n          transition: all 0.3s ease;\n        }\n\n        .theme-toggle:hover {\n          background-color: var(--border-color);\n          transform: translateY(-1px);\n        }\n\n        .theme-icon {\n          font-size: 16px;\n          transition: transform 0.3s ease;\n        }\n\n        .section { \n          margin-bottom: 30px; \n          padding: 20px; \n          background-color: var(--bg-secondary);\n          border: 1px solid var(--border-color); \n          border-radius: 8px; \n        }\n\n        .subsection { \n          margin-bottom: 20px; \n          padding: 15px; \n          background-color: var(--bg-tertiary); \n          border-radius: 5px; \n        }\n\n        .form-group { margin-bottom: 10px; }\n        .form-group input { \n          margin-right: 10px; \n          padding: 8px; \n          border: 1px solid var(--border-color); \n          border-radius: 4px; \n          background-color: var(--bg-primary);\n          color: var(--text-primary);\n        }\n        .form-group button { \n          padding: 8px 15px; \n          background-color: var(--btn-primary); \n          color: white; \n          border: none; \n          border-radius: 4px; \n          cursor: pointer; \n        }\n        .form-group button:hover { background-color: var(--btn-primary-hover); }\n\n        .instructions-text {\n          color: var(--text-secondary);\n          font-size: 14px;\n          margin-bottom: 15px;\n        }\n\n        .secondary-btn {\n          background-color: var(--btn-secondary) !important;\n        }\n\n        .secondary-btn:hover {\n          background-color: var(--btn-secondary-hover) !important;\n        }\n        \n        /* Bills List - Horizontal Layout */\n        #billsList {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 15px;\n          margin-top: 15px;\n        }\n        .bill-item { \n          flex: 1 1 300px;\n          min-width: 280px;\n          max-width: 350px;\n          padding: 15px; \n          background-color: var(--bg-tertiary); \n          border-radius: 8px; \n          cursor: pointer; \n          display: flex; \n          flex-direction: column;\n          justify-content: space-between;\n          transition: all 0.2s ease;\n          border: 2px solid transparent;\n        }\n        .bill-item:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 4px 8px var(--shadow);\n        }\n        .bill-item.active { \n          background-color: var(--btn-primary); \n          color: white; \n          border-color: var(--btn-primary-hover);\n        }\n        .bill-item-content { \n          flex-grow: 1; \n          margin-bottom: 10px;\n        }\n        .bill-item-title {\n          font-size: 16px;\n          font-weight: bold;\n          margin-bottom: 8px;\n        }\n        .bill-item-stats {\n          font-size: 12px;\n          line-height: 1.4;\n        }\n        .bill-item-actions { \n          display: flex; \n          justify-content: flex-end;\n          margin-top: 10px;\n        }\n        \n        .bill-header { \n          display: flex; \n          justify-content: space-between; \n          align-items: center; \n          margin-bottom: 20px; \n        }\n        .delete-bill-btn { \n          background-color: var(--btn-danger); \n          color: white; \n          border: none; \n          padding: 10px 20px; \n          border-radius: 4px; \n          cursor: pointer; \n          font-size: 14px;\n        }\n        .delete-bill-btn:hover { background-color: var(--btn-danger-hover); }\n        \n        /* Summary header with action buttons */\n        .summary-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: 10px;\n        }\n        .action-buttons {\n          display: flex;\n          gap: 10px;\n        }\n        .add-person-btn-external {\n          background-color: var(--btn-success);\n          color: white;\n          border: none;\n          padding: 8px 16px;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 14px;\n          font-weight: normal;\n        }\n        .add-person-btn-external:hover { background-color: var(--btn-success-hover); }\n        .add-item-btn-external {\n          background-color: var(--btn-primary);\n          color: white;\n          border: none;\n          padding: 8px 16px;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 14px;\n          font-weight: normal;\n        }\n        .add-item-btn-external:hover { background-color: var(--btn-primary-hover); }\n        \n        .export-btn-external {\n          background-color: #6f42c1;\n          color: white;\n          border: none;\n          padding: 8px 16px;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 14px;\n          font-weight: normal;\n          transition: all 0.2s ease;\n        }\n        .export-btn-external:hover { \n          background-color: #5a32a3; \n          transform: translateY(-1px);\n        }\n\n        /* Modal Styles - Enhanced Design */\n        .modal-overlay {\n          position: fixed;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          background: rgba(0, 0, 0, 0.6);\n          backdrop-filter: blur(4px);\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          z-index: 1000;\n          opacity: 0;\n          animation: modalFadeIn 0.2s ease-out forwards;\n        }\n\n        @keyframes modalFadeIn {\n          from {\n            opacity: 0;\n          }\n          to {\n            opacity: 1;\n          }\n        }\n\n        @keyframes modalSlideIn {\n          from {\n            transform: translateY(-20px) scale(0.95);\n            opacity: 0;\n          }\n          to {\n            transform: translateY(0) scale(1);\n            opacity: 1;\n          }\n        }\n\n        .modal-content {\n          background: var(--bg-primary);\n          border-radius: 16px;\n          padding: 0;\n          width: 90%;\n          max-width: 440px;\n          max-height: 90vh;\n          overflow: hidden;\n          box-shadow: \n            0 20px 25px -5px rgba(0, 0, 0, 0.1),\n            0 10px 10px -5px rgba(0, 0, 0, 0.04),\n            0 0 0 1px var(--border-color);\n          animation: modalSlideIn 0.2s ease-out forwards;\n          position: relative;\n        }\n\n        [data-theme="dark"] .modal-content {\n          box-shadow: \n            0 20px 25px -5px rgba(0, 0, 0, 0.4),\n            0 10px 10px -5px rgba(0, 0, 0, 0.2),\n            0 0 0 1px var(--border-color);\n        }\n\n        .modal-header {\n          padding: 24px 24px 0 24px;\n          border-bottom: 1px solid var(--border-light);\n          background: var(--bg-secondary);\n          position: relative;\n        }\n\n        .modal-title {\n          font-size: 20px;\n          font-weight: 600;\n          color: var(--text-primary);\n          margin: 0 0 16px 0;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n\n        .modal-title::before {\n          content: "👤";\n        }\n\n        .modal-content[data-modal="item"] .modal-title::before {\n          content: "🧾";\n        }\n\n        .modal-close {\n          position: absolute;\n          top: 16px;\n          right: 16px;\n          background: none;\n          border: none;\n          font-size: 24px;\n          color: var(--text-secondary);\n          cursor: pointer;\n          padding: 8px;\n          border-radius: 8px;\n          transition: all 0.2s ease;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          width: 40px;\n          height: 40px;\n        }\n\n        .modal-close:hover {\n          background: var(--bg-tertiary);\n          color: var(--text-primary);\n          transform: scale(1.1);\n        }\n\n        .modal-body {\n          padding: 24px;\n          background: var(--bg-primary);\n        }\n\n        .modal-form-group {\n          margin-bottom: 20px;\n        }\n\n        .modal-form-group:last-child {\n          margin-bottom: 0;\n        }\n\n        .modal-label {\n          display: block;\n          font-size: 14px;\n          font-weight: 600;\n          color: var(--text-primary);\n          margin-bottom: 8px;\n          text-transform: uppercase;\n          letter-spacing: 0.5px;\n        }\n\n        .modal-input {\n          width: 100%;\n          padding: 12px 16px;\n          border: 2px solid var(--border-color);\n          border-radius: 8px;\n          font-size: 16px;\n          color: var(--text-primary);\n          background: var(--bg-primary);\n          transition: all 0.2s ease;\n          box-sizing: border-box;\n        }\n\n        .modal-input:focus {\n          outline: none;\n          border-color: var(--btn-primary);\n          box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);\n          transform: translateY(-1px);\n        }\n\n        .modal-input::placeholder {\n          color: var(--text-secondary);\n          font-style: italic;\n        }\n\n        .modal-input.error {\n          border-color: var(--btn-danger);\n          box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);\n        }\n\n        .modal-input-icon {\n          position: relative;\n        }\n\n        .modal-input-icon::before {\n          content: "";\n          position: absolute;\n          left: 12px;\n          top: 50%;\n          transform: translateY(-50%);\n          width: 16px;\n          height: 16px;\n          background: var(--text-secondary);\n          z-index: 1;\n        }\n\n        .modal-input-icon .modal-input {\n          padding-left: 40px;\n        }\n\n        .modal-footer {\n          padding: 16px 24px 24px 24px;\n          background: var(--bg-secondary);\n          display: flex;\n          gap: 12px;\n          justify-content: flex-end;\n          border-top: 1px solid var(--border-light);\n        }\n\n        .modal-btn {\n          padding: 12px 24px;\n          border: none;\n          border-radius: 8px;\n          font-size: 14px;\n          font-weight: 600;\n          cursor: pointer;\n          transition: all 0.2s ease;\n          text-transform: uppercase;\n          letter-spacing: 0.5px;\n          min-width: 80px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: 6px;\n        }\n\n        .modal-btn-primary {\n          background: var(--btn-primary);\n          color: white;\n        }\n\n        .modal-btn-primary:hover {\n          background: var(--btn-primary-hover);\n          transform: translateY(-2px);\n          box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);\n        }\n\n        .modal-btn-primary:disabled {\n          background: var(--text-secondary);\n          cursor: not-allowed;\n          transform: none;\n          box-shadow: none;\n        }\n\n        .modal-btn-secondary {\n          background: transparent;\n          color: var(--text-secondary);\n          border: 2px solid var(--border-color);\n        }\n\n        .modal-btn-secondary:hover {\n          background: var(--bg-tertiary);\n          color: var(--text-primary);\n          border-color: var(--text-secondary);\n          transform: translateY(-1px);\n        }\n\n        .modal-form-hint {\n          font-size: 12px;\n          color: var(--text-secondary);\n          margin-top: 4px;\n          font-style: italic;\n        }\n\n        .modal-error-message {\n          color: var(--btn-danger);\n          font-size: 12px;\n          margin-top: 4px;\n          font-weight: 500;\n          display: none;\n        }\n\n        .modal-success-message {\n          color: var(--btn-success);\n          font-size: 12px;\n          margin-top: 4px;\n          font-weight: 500;\n          display: none;\n        }\n\n        /* Mobile Responsiveness */\n        @media (max-width: 768px) {\n          .modal-content {\n            width: 95%;\n            margin: 20px;\n            max-width: none;\n          }\n\n          .modal-header,\n          .modal-body,\n          .modal-footer {\n            padding-left: 20px;\n            padding-right: 20px;\n          }\n\n          .modal-title {\n            font-size: 18px;\n          }\n\n          .modal-footer {\n            flex-direction: column-reverse;\n          }\n\n          .modal-btn {\n            width: 100%;\n            justify-content: center;\n          }\n        }\n\n        /* Loading States */\n        .modal-btn.loading {\n          position: relative;\n          color: transparent;\n        }\n\n        .modal-btn.loading::after {\n          content: "";\n          position: absolute;\n          width: 16px;\n          height: 16px;\n          border: 2px solid transparent;\n          border-top: 2px solid currentColor;\n          border-radius: 50%;\n          animation: spin 1s linear infinite;\n          color: white;\n        }\n\n        @keyframes spin {\n          to {\n            transform: rotate(360deg);\n          }\n        }\n\n        /* Focus trap for accessibility */\n        .modal-overlay[aria-hidden="false"] {\n          pointer-events: auto;\n        }\n\n        .modal-overlay[aria-hidden="true"] {\n          pointer-events: none;\n        }\n        \n        /* Table Styles - Using CSS Variables */\n        .summary-table-container {\n          overflow-x: auto;\n          margin-top: 15px;\n          border-radius: 12px;\n          box-shadow: 0 10px 15px -3px var(--shadow);\n        }\n        \n        table { \n          width: 100%; \n          border-collapse: collapse; \n          background-color: var(--table-bg);\n          color: var(--table-person-text);\n          border-radius: 12px;\n          overflow: hidden;\n        }\n        \n        th, td { \n          padding: 16px 12px;\n          text-align: center; \n          border: none;\n          font-size: 14px;\n          vertical-align: middle;\n          box-sizing: border-box;\n          transition: all 0.2s ease;\n        }\n        \n        th { \n          background-color: var(--table-header-bg);\n          color: var(--table-header-text);\n          font-weight: 600; \n          font-size: 13px;\n          text-transform: uppercase;\n          letter-spacing: 0.05em;\n          white-space: nowrap;\n          border-bottom: 1px solid var(--table-border);\n        }\n        \n        /* Striped Columns Effect */\n        td:nth-child(odd) {\n          background-color: var(--table-row-odd);\n        }\n        \n        td:nth-child(even) {\n          background-color: var(--table-row-even);\n        }\n        \n        /* Hover effects */\n        tbody tr:hover td {\n          background-color: var(--table-row-hover) !important;\n          transform: scale(1.01);\n        }\n        \n        /* Person column styles */\n        .person-header {\n          background-color: var(--table-header-bg) !important;\n          color: var(--table-header-text) !important;\n          font-weight: 600;\n          min-width: 180px;\n          width: 100%;\n          height: 100%;\n          padding: 16px;\n          display: flex;\n          align-items: center;\n          text-align: left;\n          border: none;\n          margin: 0;\n          box-sizing: border-box;\n        }\n        \n        /* Person row cell - Full expansion */\n        .person-row-cell {\n          background-color: var(--table-person-bg) !important;\n          color: var(--table-person-text) !important;\n          font-weight: 500;\n          min-width: 180px;\n          width: 100%;\n          height: 100%;\n          padding: 16px;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          text-align: left;\n          border: none;\n          margin: 0;\n          box-sizing: border-box;\n          position: absolute;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n        }\n        \n        /* Parent td for person row */\n        .person-cell {\n          padding: 0 !important;\n          position: relative;\n          min-width: 180px;\n          background-color: var(--table-person-bg) !important;\n        }\n        \n        .person-name-column { \n          text-align: left !important; \n          font-weight: 600; \n          background-color: var(--table-person-bg) !important;\n          color: var(--table-person-text) !important;\n          min-width: 180px;\n          padding: 0 !important;\n          position: relative;\n        }\n        \n        /* Item column styles */\n        .item-header {\n          background-color: var(--table-header-bg) !important;\n          color: var(--table-header-text) !important;\n          font-weight: 600;\n          min-width: 120px;\n          padding: 12px 8px;\n          text-align: center;\n        }\n        \n        .item-header-content {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          gap: 8px;\n        }\n        \n        .item-name-price {\n          text-align: center;\n          line-height: 1.3;\n          color: var(--table-header-text);\n        }\n        \n        .item-delete-btn {\n          background-color: var(--btn-danger);\n          color: white;\n          border: none;\n          padding: 4px 8px;\n          border-radius: 6px;\n          cursor: pointer;\n          font-size: 10px;\n          font-weight: 500;\n          transition: background-color 0.2s ease;\n        }\n        .item-delete-btn:hover { \n          background-color: var(--btn-danger-hover); \n          transform: scale(1.05);\n        }\n        \n        /* Total column styles */\n        .total-column {\n          background-color: var(--table-total-bg) !important;\n          color: var(--table-total-text) !important;\n          font-weight: 700;\n          min-width: 100px;\n          padding: 16px;\n        }\n        \n        .total-row { \n          font-weight: 700; \n          background-color: var(--table-total-bg) !important;\n        }\n        \n        .total-row td {\n          background-color: var(--table-total-bg) !important;\n          color: var(--table-total-text) !important;\n          padding: 16px;\n          font-weight: 600;\n        }\n        \n        /* Checkbox cell styles */\n        .checkbox-cell {\n          padding: 16px;\n          position: relative;\n        }\n        \n        .divider-checkbox {\n          transform: scale(1.3);\n          cursor: pointer;\n          accent-color: var(--btn-success);\n          margin-bottom: 8px;\n        }\n        \n        .checkbox-cell small {\n          display: block;\n          font-size: 11px;\n          font-weight: 500;\n          margin-top: 4px;\n        }\n        \n        .person-name {\n          flex-grow: 1;\n          color: var(--table-person-text);\n        }\n        \n        .person-delete-btn {\n          background-color: var(--btn-danger);\n          color: white;\n          border: none;\n          padding: 6px 10px;\n          border-radius: 6px;\n          cursor: pointer;\n          font-size: 11px;\n          margin-left: 12px;\n          flex-shrink: 0;\n          font-weight: 500;\n          transition: all 0.2s ease;\n        }\n        .person-delete-btn:hover { \n          background-color: var(--btn-danger-hover); \n          transform: scale(1.05);\n        }\n        \n        .add-person-btn {\n          background-color: var(--btn-success);\n          color: white;\n          border: none;\n          padding: 6px 10px;\n          border-radius: 6px;\n          cursor: pointer;\n          font-size: 10px;\n          font-weight: 500;\n          flex-shrink: 0;\n          transition: all 0.2s ease;\n        }\n        .add-person-btn:hover { \n          background-color: var(--btn-success-hover); \n          transform: scale(1.05);\n        }\n        \n        .empty-cell {\n          background-color: var(--table-row-even);\n          color: var(--text-secondary);\n          font-style: italic;\n        }\n        \n        .amount-cell {\n          font-weight: 600;\n          background-color: var(--btn-success);\n          color: white;\n        }\n        \n        .item-info {\n          display: inline-block;\n          margin: 5px;\n          padding: 6px 12px;\n          background-color: var(--bg-tertiary);\n          color: var(--text-primary);\n          border-radius: 6px;\n          font-size: 12px;\n          font-weight: 500;\n        }\n        \n        .remove-btn { \n          background-color: var(--btn-danger); \n          color: white; \n          border: none; \n          padding: 4px 10px; \n          border-radius: 6px; \n          cursor: pointer; \n          margin-left: 8px;\n          font-size: 11px;\n          font-weight: 500;\n          transition: all 0.2s ease;\n        }\n        .remove-btn:hover { \n          background-color: var(--btn-danger-hover); \n          transform: scale(1.05);\n        }\n        \n        .bill-delete-btn { \n          background-color: var(--btn-danger); \n          color: white; \n          border: none; \n          padding: 5px 10px; \n          border-radius: 3px; \n          cursor: pointer; \n          font-size: 12px;\n        }\n        .bill-delete-btn:hover { background-color: var(--btn-danger-hover); }\n        \n        .empty-state { \n          text-align: center; \n          padding: 40px; \n          color: var(--text-secondary); \n          font-style: italic; \n          flex: 1 1 100%;\n        }\n        \n        .no-data-message {\n          text-align: center;\n          padding: 30px;\n          color: var(--text-secondary);\n          font-style: italic;\n          background-color: var(--bg-secondary);\n          border-radius: 8px;\n          border: 2px dashed var(--border-color);\n        }\n        \n        .list-container {\n          margin-top: 10px;\n        }\n        \n        .empty-persons-message {\n          text-align: center;\n          padding: 40px 20px;\n          color: var(--text-secondary);\n          font-style: italic;\n          border: 2px dashed var(--border-color);\n          border-radius: 8px;\n          margin: 20px 0;\n          background-color: var(--bg-secondary);\n        }\n        \n        .empty-items-message {\n          text-align: center;\n          padding: 40px 20px;\n          color: var(--text-secondary);\n          font-style: italic;\n          border: 2px dashed var(--border-color);\n          border-radius: 8px;\n          margin: 20px 0;\n          background-color: var(--bg-secondary);\n        }\n        \n        /* Responsive design for smaller screens */\n        @media (max-width: 768px) {\n          .app-header {\n            flex-direction: column;\n            gap: 15px;\n            text-align: center;\n          }\n\n          #billsList {\n            flex-direction: column;\n          }\n          .bill-item {\n            max-width: none;\n          }\n          \n          th, td {\n            padding: 12px 8px;\n            font-size: 13px;\n          }\n          \n          .person-header, .person-row-cell {\n            min-width: 140px;\n            padding: 12px;\n          }\n          \n          .item-header {\n            min-width: 100px;\n            padding: 8px 6px;\n          }\n        }\n      </style>\n    ',window.billUI=this,this.updateBillsList()}toggleTheme(){this.isDarkTheme=!this.isDarkTheme,localStorage.setItem("billCalculatorTheme",this.isDarkTheme?"dark":"light"),this.applyTheme()}applyTheme(){const n=document.body,e=(document.getElementById("themeToggle"),document.querySelector(".theme-icon")),t=document.querySelector(".theme-text");this.isDarkTheme?(n.setAttribute("data-theme","dark"),e&&(e.textContent="☀️"),t&&(t.textContent="Light")):(n.removeAttribute("data-theme"),e&&(e.textContent="🌙"),t&&(t.textContent="Dark"))}createNewBill(){const n=document.getElementById("billName"),e=n.value.trim();if(!e)return void alert("Please enter a bill name");const t=this.calculator.createBill(e);n.value="",this.updateBillsList(),this.selectBill(t)}selectBill(n){this.currentBillId=n;const e=this.calculator.getBill(n);e&&(document.getElementById("currentBillTitle").textContent=`Current Bill: ${e.name}`,document.getElementById("currentBillSection").style.display="block",this.updateBillsList(),this.updateSummaryTable())}deleteBill(n){const e=this.calculator.getBill(n);if(!e)return;const t=`Are you sure you want to delete "${e.name}"?\n\nThis will permanently remove:\n- ${e.persons.length} person(s)\n- ${e.items.length} item(s)\n- All associated data\n\nThis action cannot be undone.`;confirm(t)&&(this.calculator.deleteBill(n)?(this.currentBillId===n&&(this.currentBillId=null,document.getElementById("currentBillSection").style.display="none"),this.updateBillsList()):alert("Failed to delete bill. Please try again."))}deleteCurrentBill(){this.currentBillId&&this.deleteBill(this.currentBillId)}showPersonModal(){const n=document.getElementById("personInputModal"),e=document.getElementById("modalPersonName");n.style.display="flex",n.setAttribute("aria-hidden","false"),e.value="",this.clearModalErrors("person"),setTimeout((()=>{e.focus(),e.select()}),150),document.body.style.overflow="hidden"}closePersonModal(){const n=document.getElementById("personInputModal");n.style.display="none",n.setAttribute("aria-hidden","true"),document.getElementById("modalPersonName").value="",this.clearModalErrors("person"),document.body.style.overflow=""}addPersonFromModal(){if(!this.currentBillId)return;const n=document.getElementById("modalPersonName"),e=document.getElementById("addPersonBtn"),t=n.value.trim();if(this.clearModalErrors("person"),!t)return this.showModalError("person","personName","Please enter a person name"),void n.focus();if(t.length<2)return this.showModalError("person","personName","Name must be at least 2 characters"),void n.focus();const o=this.calculator.getBill(this.currentBillId);if(o?.persons.some((n=>n.name.toLowerCase()===t.toLowerCase())))return this.showModalError("person","personName","This person is already added"),void n.focus();e.classList.add("loading"),e.disabled=!0,this.calculator.addPerson(this.currentBillId,t),this.closePersonModal(),this.updateSummaryTable(),e.classList.remove("loading"),e.disabled=!1}showItemModal(){const n=document.getElementById("itemInputModal"),e=document.getElementById("modalItemName");n.style.display="flex",n.setAttribute("aria-hidden","false"),e.value="",document.getElementById("modalItemPrice").value="",this.clearModalErrors("item"),setTimeout((()=>{e.focus(),e.select()}),150),document.body.style.overflow="hidden"}closeItemModal(){const n=document.getElementById("itemInputModal");n.style.display="none",n.setAttribute("aria-hidden","true"),document.getElementById("modalItemName").value="",document.getElementById("modalItemPrice").value="",this.clearModalErrors("item"),document.body.style.overflow=""}addItemFromModal(){if(!this.currentBillId)return;const n=document.getElementById("modalItemName"),e=document.getElementById("modalItemPrice"),t=document.getElementById("addItemBtn"),o=n.value.trim(),r=parseFloat(e.value);this.clearModalErrors("item");let a=!1;o?o.length<2&&(this.showModalError("item","itemName","Item name must be at least 2 characters"),a=!0):(this.showModalError("item","itemName","Please enter an item name"),a=!0),!e.value||isNaN(r)?(this.showModalError("item","itemPrice","Please enter a valid price"),a=!0):r<=0?(this.showModalError("item","itemPrice","Price must be greater than 0"),a=!0):r>9999.99&&(this.showModalError("item","itemPrice","Price cannot exceed $9,999.99"),a=!0),a?o?e.value&&!isNaN(r)||e.focus():n.focus():(t.classList.add("loading"),t.disabled=!0,this.calculator.addItem(this.currentBillId,o,r),this.closeItemModal(),this.updateSummaryTable(),t.classList.remove("loading"),t.disabled=!1)}clearModalErrors(n){if("person"===n){const n=document.getElementById("personNameError");n&&(n.style.display="none",n.textContent="");const e=document.getElementById("modalPersonName");e&&e.classList.remove("error")}else{const n=document.getElementById("itemNameError"),e=document.getElementById("itemPriceError");n&&(n.style.display="none",n.textContent=""),e&&(e.style.display="none",e.textContent="");const t=document.getElementById("modalItemName"),o=document.getElementById("modalItemPrice");t&&t.classList.remove("error"),o&&o.classList.remove("error")}}showModalError(n,e,t){if("person"===n){const n=document.getElementById("personNameError"),e=document.getElementById("modalPersonName");n&&(n.textContent=t,n.style.display="block"),e&&e.classList.add("error")}else{const n=document.getElementById("itemName"===e?"itemNameError":"itemPriceError"),o=document.getElementById("itemName"===e?"modalItemName":"modalItemPrice");n&&(n.textContent=t,n.style.display="block"),o&&o.classList.add("error")}}addItem(){this.showItemModal()}toggleDividerFromTable(n,e){this.currentBillId&&(this.calculator.togglePersonAsDivider(this.currentBillId,n,e),this.updateSummaryTable())}removePerson(n){if(!this.currentBillId)return;const e=this.calculator.getBill(this.currentBillId),t=e?.persons.find((e=>e.id===n));confirm(`Remove "${t?.name}" from this bill?`)&&(this.calculator.removePerson(this.currentBillId,n),this.updateSummaryTable())}removeItem(n){if(!this.currentBillId)return;const e=this.calculator.getBill(this.currentBillId),t=e?.items.find((e=>e.id===n));confirm(`Remove "${t?.name}" ($${t?.price.toFixed(2)}) from this bill?`)&&(this.calculator.removeItem(this.currentBillId,n),this.updateSummaryTable())}updateBillsList(){const n=document.getElementById("billsList"),e=this.calculator.getBills();0!==e.length?n.innerHTML=e.map((n=>{const e=this.calculator.calculateBillSummary(n.id).reduce(((n,e)=>n+e.totalAmount),0);return`\n        <div class="bill-item ${n.id===this.currentBillId?"active":""}">\n          <div class="bill-item-content" onclick="billUI.selectBill('${n.id}')">\n            <div class="bill-item-title">${n.name}</div>\n            <div class="bill-item-stats" style="color: ${n.id===this.currentBillId?"#ffffff":"var(--text-secondary)"};">\n              👥 ${n.persons.length} person(s)<br>\n              🧾 ${n.items.length} item(s)<br>\n              💰 Total: $${e.toFixed(2)}\n            </div>\n          </div>\n          <div class="bill-item-actions">\n            <button class="bill-delete-btn" onclick="event.stopPropagation(); billUI.deleteBill('${n.id}')">\n              Delete\n            </button>\n          </div>\n        </div>\n      `})).join(""):n.innerHTML='<div class="empty-state">No bills created yet. Create your first bill above!</div>'}updateSummaryTable(){if(!this.currentBillId)return;const n=this.calculator.getBill(this.currentBillId),e=document.getElementById("summaryTable"),t=document.getElementById("addPersonBtn"),o=document.getElementById("addItemBtn"),r=document.getElementById("exportBtn");if(!n)return e.innerHTML='<div class="no-data-message">Bill not found.</div>',t.style.display="none",o.style.display="none",void(r.style.display="none");if(t.style.display="inline-block",o.style.display="inline-block",0===n.persons.length)return e.innerHTML='\n        <div class="empty-persons-message">\n          <h4>No persons added yet</h4>\n          <p>Add people to split the bill costs</p>\n          <p style="color: var(--btn-success); font-weight: bold;">↗ Use the "Add Person" button above</p>\n        </div>\n      ',void(r.style.display="none");r.style.display="inline-block";const a={},l={},i={};n.persons.forEach((e=>{a[e.id]={},i[e.id]=0,n.items.forEach((n=>{a[e.id][n.id]=0,l[n.id]||(l[n.id]=0)}))})),n.items.forEach((n=>{if(n.dividers.length>0){const e=n.price/n.dividers.length;n.dividers.forEach((t=>{a[t]&&(a[t][n.id]=e,i[t]+=e,l[n.id]+=e)}))}}));const s=Object.values(i).reduce(((n,e)=>n+e),0);e.innerHTML=`\n      <div class="summary-table-container">\n        <table>\n          <thead>\n            <tr>\n              <th style="padding: 0;">\n                <div class="person-header">\n                  Person\n                </div>\n              </th>\n              ${n.items.map((n=>`\n                <th class="item-header">\n                  <div class="item-header-content">\n                    <div class="item-name-price">\n                      ${n.name}<br>\n                      <small style="font-weight: normal; color: var(--text-secondary);">($${n.price.toFixed(2)})</small>\n                    </div>\n                    <button class="item-delete-btn" onclick="billUI.removeItem('${n.id}')" title="Delete ${n.name}">\n                      Delete\n                    </button>\n                  </div>\n                </th>\n              `)).join("")}\n              <th class="total-column">Total</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${n.persons.map((e=>`\n              <tr>\n                <td class="person-cell">\n                  <div class="person-row-cell">\n                    <span class="person-name">${e.name}</span>\n                    <button class="person-delete-btn" onclick="billUI.removePerson('${e.id}')">\n                      Delete\n                    </button>\n                  </div>\n                </td>\n                ${n.items.map((n=>{const t=a[e.id][n.id];return`\n                    <td class="checkbox-cell">\n                      <input type="checkbox" \n                             class="divider-checkbox" \n                             ${n.dividers.includes(e.id)?"checked":""} \n                             onchange="billUI.toggleDividerFromTable('${n.id}', '${e.id}')"\n                             id="checkbox_${e.id}_${n.id}">\n                      <small style="color: ${t>0?"var(--btn-success)":"var(--text-secondary)"}; font-weight: ${t>0?"600":"normal"};">\n                        ${t>0?`$${t.toFixed(2)}`:"-"}\n                      </small>\n                    </td>\n                  `})).join("")}\n                <td class="total-column">$${i[e.id].toFixed(2)}</td>\n              </tr>\n            `)).join("")}\n            <tr class="total-row">\n              <td class="person-cell">\n                <div class="person-row-cell" style="background-color: var(--table-total-bg) !important;">\n                  <span class="person-name" style="color: var(--table-total-text);">Total</span>\n                </div>\n              </td>\n              ${n.items.map((n=>`\n                <td class="total-column">$${l[n.id].toFixed(2)}</td>\n              `)).join("")}\n              <td class="total-column">$${s.toFixed(2)}</td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    `,document.addEventListener("keydown",(n=>{"Enter"===n.key&&"flex"===document.getElementById("personInputModal").style.display&&this.addPersonFromModal(),"Enter"===n.key&&"flex"===document.getElementById("itemInputModal").style.display&&this.addItemFromModal(),"Escape"===n.key&&(this.closePersonModal(),this.closeItemModal())}))}exportTableToImage(){if(!this.currentBillId)return;const n=this.calculator.getBill(this.currentBillId);if(!n||0===n.items.length||0===n.persons.length)return void alert("No data to export. Please add items and people first.");const e=document.createElement("div");e.style.position="absolute",e.style.left="-10000px",e.style.top="-10000px",e.style.background=this.isDarkTheme?"#1f2937":"#ffffff",e.style.padding="20px",e.style.fontFamily="Arial, sans-serif",e.style.color=this.isDarkTheme?"#f9fafb":"#212529";const t=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});e.innerHTML=`\n      <div style="margin-bottom: 20px; text-align: center;">\n        <h2 style="margin: 0 0 10px 0; color: ${this.isDarkTheme?"#f3f4f6":"#212529"};">Bill Calculator Export</h2>\n        <h3 style="margin: 0 0 5px 0; color: ${this.isDarkTheme?"#f9fafb":"#495057"};">${n.name}</h3>\n        <p style="margin: 0; font-size: 14px; color: ${this.isDarkTheme?"#cccccc":"#6c757d"};">Generated on ${t}</p>\n      </div>\n      ${document.querySelector(".summary-table-container")?.outerHTML||""}\n    `,document.body.appendChild(e),this.createTableImageCanvas(e,n.name),document.body.removeChild(e)}createTableImageCanvas(n,e){const t=document.createElement("canvas"),o=t.getContext("2d");if(!o)return;const r=this.calculator.getBill(this.currentBillId);if(!r)return;const a=180+100*r.items.length+100+40,l=Math.min(Math.max(a,800),1400);t.width=l,t.height=Math.max(600,200+45*(r.persons.length+2));const i=t.width-40,s=i-180-100,d=Math.max(100,s/r.items.length);o.fillStyle=this.isDarkTheme?"#1f2937":"#ffffff",o.fillRect(0,0,t.width,t.height);const c={},m={},p={};r.persons.forEach((n=>{c[n.id]={},p[n.id]=0,r.items.forEach((e=>{c[n.id][e.id]=0,m[e.id]||(m[e.id]=0)}))})),r.items.forEach((n=>{if(n.dividers.length>0){const e=n.price/n.dividers.length;n.dividers.forEach((t=>{c[t]&&(c[t][n.id]=e,p[t]+=e,m[n.id]+=e)}))}}));const b=Object.values(p).reduce(((n,e)=>n+e),0);o.fillStyle=this.isDarkTheme?"#f3f4f6":"#212529",o.font="bold 24px Arial",o.textAlign="center",o.fillText("Bill Calculator Export",t.width/2,40),o.font="bold 18px Arial",o.fillStyle=this.isDarkTheme?"#f9fafb":"#495057",o.fillText(r.name,t.width/2,70),o.font="14px Arial",o.fillStyle=this.isDarkTheme?"#cccccc":"#6c757d";const h=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});o.fillText(`Generated on ${h}`,t.width/2,90);const u=120,g=45,f=t.width-40;o.strokeStyle=this.isDarkTheme?"#374151":"#495057",o.lineWidth=2,o.strokeRect(20,u,f,55+(r.persons.length+1)*g),o.fillStyle=this.isDarkTheme?"#111827":"#343a40",o.fillRect(20,u,f,55),o.strokeStyle=this.isDarkTheme?"#374151":"#6c757d",o.lineWidth=1;let x=200;o.moveTo(x,u),o.lineTo(x,175),o.stroke(),r.items.forEach(((n,e)=>{x+=d,o.moveTo(x,u),o.lineTo(x,175),o.stroke()})),o.fillStyle=this.isDarkTheme?"#f3f4f6":"#ffffff",o.font="bold 16px Arial",o.textAlign="left",o.fillText("Person",35,145),x=200,r.items.forEach((n=>{o.textAlign="center",o.font="bold 14px Arial";const e=d-20,t=n.name.split(" ");let r="",a=[];for(let n=0;n<t.length;n++){const l=r+t[n]+" ";o.measureText(l).width>e&&n>0?(a.push(r),r=t[n]+" "):r=l}a.push(r);const l=140-16*(a.length-1)/2;a.forEach(((n,e)=>{o.fillText(n.trim(),x+d/2,l+16*e)})),o.font="12px Arial",o.fillStyle=this.isDarkTheme?"#cccccc":"#e9ecef",o.fillText(`($${n.price.toFixed(2)})`,x+d/2,165),o.fillStyle=this.isDarkTheme?"#f3f4f6":"#ffffff",x+=d})),o.font="bold 16px Arial",o.textAlign="center",o.fillText("Total",x+50,150);let v=175;r.persons.forEach(((n,e)=>{const t=e%2==0?this.isDarkTheme?"#374151":"#f8f9fa":this.isDarkTheme?"#4b5563":"#e9ecef";o.fillStyle=t,o.fillRect(20,v,f,g),o.fillStyle=this.isDarkTheme?"#374151":"#6c757d",o.fillRect(20,v,180,g),o.strokeStyle=this.isDarkTheme?"#4b5563":"#dee2e6",o.lineWidth=1,x=200,o.moveTo(x,v),o.lineTo(x,v+g),o.stroke(),r.items.forEach(((n,e)=>{x+=d,o.moveTo(x,v),o.lineTo(x,v+g),o.stroke()})),o.fillStyle=this.isDarkTheme?"#f9fafb":"#ffffff",o.font="bold 16px Arial",o.textAlign="left";let a=n.name;for(;o.measureText(a).width>150&&a.length>3;)a=a.substring(0,a.length-4)+"...";o.fillText(a,35,v+28),x=200,r.items.forEach((e=>{const t=c[n.id][e.id],r=e.dividers.includes(n.id);o.textAlign="center",o.font="bold 14px Arial",r&&t>0?(o.fillStyle=this.isDarkTheme?"#10b981":"#28a745",o.fillText("✓",x+d/2,v+20),o.font="12px Arial",o.fillText(`$${t.toFixed(2)}`,x+d/2,v+35)):(o.fillStyle=this.isDarkTheme?"#9ca3af":"#6c757d",o.font="16px Arial",o.fillText("-",x+d/2,v+28)),x+=d})),o.fillStyle=this.isDarkTheme?"#059669":"#28a745",o.fillRect(x,v,100,g),o.fillStyle=this.isDarkTheme?"#f0fff4":"#ffffff",o.font="bold 16px Arial",o.textAlign="center",o.fillText(`$${p[n.id].toFixed(2)}`,x+50,v+28),v+=g})),o.fillStyle=this.isDarkTheme?"#059669":"#28a745",o.fillRect(20,v,f,g),o.strokeStyle=this.isDarkTheme?"#047857":"#1e7e34",o.lineWidth=1,x=200,o.moveTo(x,v),o.lineTo(x,v+g),o.stroke(),r.items.forEach(((n,e)=>{x+=d,o.moveTo(x,v),o.lineTo(x,v+g),o.stroke()})),o.fillStyle=this.isDarkTheme?"#f0fff4":"#ffffff",o.font="bold 18px Arial",o.textAlign="left",o.fillText("Total",35,v+30),x=200,o.font="bold 16px Arial",r.items.forEach((n=>{o.textAlign="center",o.fillText(`$${m[n.id].toFixed(2)}`,x+d/2,v+30),x+=d})),o.font="bold 18px Arial",o.textAlign="center",o.fillText(`$${b.toFixed(2)}`,x+50,v+30),t.toBlob((n=>{if(n){const t=URL.createObjectURL(n),o=document.createElement("a");o.href=t,o.download=`${e.replace(/[^a-zA-Z0-9]/g,"_")}_summary_${(new Date).toISOString().split("T")[0]}.png`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t)}}),"image/png")}}document.addEventListener("DOMContentLoaded",(()=>{new e})),window.BillCalculatorUI=e})();